<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-eval' 'wasm-unsafe-eval' https://*.google.com https://*.gstatic.com https://apis.google.com https://cdn.jsdelivr.net; script-src-elem 'self' 'unsafe-eval' 'wasm-unsafe-eval' https://*.google.com https://*.gstatic.com https://apis.google.com https://cdn.jsdelivr.net; connect-src 'self' https://openlibrary.org https://*.googleapis.com https://*.google.com https://*.gstatic.com https://firestore.googleapis.com https://cdn.jsdelivr.net https://securetoken.google.com https://identitytoolkit.googleapis.com https://apis.google.com https://firebaseinstallations.googleapis.com https://oauth2.googleapis.com; img-src 'self' https: data:; style-src 'self' 'unsafe-inline'; font-src 'self' data:; media-src 'self' blob: data:; worker-src 'self' blob:; frame-src https://*.google.com https://*.firebaseapp.com https://*.web.app; child-src https://*.google.com https://*.firebaseapp.com https://*.web.app; base-uri 'self'; upgrade-insecure-requests">
  <title>Library Tracker</title>
  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="stylesheet" href="styles/base.css" />
  <link rel="stylesheet" href="styles/shelves.css" />
  <link rel="stylesheet" href="styles/modal.css" />
  <link rel="stylesheet" href="styles/handsfree.css" />
</head>
<body>
  <!-- Firebase (compat) SDKs in head with defer to ensure availability before app runs -->
  <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script defer src="js/firebase-config.js"></script>
  <script defer src="js/firebase.js"></script>
  <header class="app-header">
    <h1>Library Tracker</h1>
    <div class="controls">
      <select id="sort-select" aria-label="Sort books" title="Sort">
        <option value="series" selected>Series (Aâ€“Z)</option>
        <option value="title">Title (Aâ€“Z)</option>
        <option value="author">Author (Aâ€“Z)</option>
        <option value="genre">Genre (Aâ€“Z)</option>
      </select>
      <div class="search-wrap">
        <input id="search-input" type="search" placeholder="Search booksâ€¦" aria-label="Search books" />
        <button id="btn-clear-search" class="icon small" aria-label="Clear search" title="Clear search" hidden>âœ•</button>
        <span id="results-count" class="results-count" aria-live="polite"></span>
      </div>
      <div class="isbn-inline" style="display:flex;gap:6px;align-items:center">
        <input id="isbn-input" type="text" inputmode="numeric" pattern="[-0-9Xx ]+" placeholder="Enter ISBNâ€¦" aria-label="Enter ISBN" />
        <button id="btn-add" aria-label="Add ISBN">Add</button>
      </div>
      <button id="btn-scan" aria-label="Open scanner">Scan</button>
      <button id="toggle-handsfree" aria-pressed="false" aria-label="Motion cursor" title="Motion cursor">âœ‹</button>
      <button id="toggle-voice" aria-pressed="false" aria-label="Voice" title="Voice">ðŸŽ¤</button>
      <button id="btn-login" aria-label="Sign in" title="Sign in with Google">Sign in</button>
      
      <div class="menu" id="hamburger">
        <button class="menu-toggle" aria-label="Menu" aria-expanded="false" aria-haspopup="true">â˜°</button>
        <div class="menu-list" role="menu">
          <button id="btn-import" role="menuitem">Import</button>
          <button id="btn-export" role="menuitem">Export</button>
          <button id="btn-settings" role="menuitem">Settings</button>
        </div>
      </div>
      <input id="file-import" type="file" accept="application/json" style="display:none" />
    </div>
  </header>

  <main>
    <section id="shelves" aria-live="polite"></section>
  </main>
  <!-- Auth Overlay -->
  <div id="auth-overlay" hidden style="position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:9999">
    <div style="background:var(--panel-bg, #fff);color:var(--text, #222);padding:24px;border-radius:10px;min-width:280px;box-shadow:0 10px 30px rgba(0,0,0,0.3)">
      <h2 style="margin-top:0;margin-bottom:12px">Sign in</h2>
      <p style="margin:0 0 16px">Sign in with Google to sync your library across devices.</p>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button id="btn-auth-google" type="button" class="accent">Sign in with Google</button>
      </div>
    </div>
  </div>


  <div id="book-modal" class="modal" aria-hidden="true" role="dialog" aria-modal="true"></div>
  <div id="scanner-overlay" hidden></div>
  <div id="handsfree-overlay" hidden>
    <div id="hf-cursor" class="hf-cursor" aria-hidden="true"></div>
  </div>
  <div id="toast-container" aria-live="polite" aria-atomic="true"></div>

  <!-- Settings Panel -->
  <div id="settings-panel" hidden></div>

  <!-- External libraries -->
  <!-- idb loaded via dynamic import in db.js to avoid MIME/CORS issues -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

  <!-- Our scripts -->
  <script src="js/utils.js"></script>
  <script src="js/db.js"></script>
  <script src="js/api.js"></script>
  <script src="js/shelves.js"></script>
  <script src="js/modal.js"></script>
  <script src="js/barcode.js"></script>
  <script src="js/search.js"></script>
  <script src="js/importExport.js"></script>
  <script src="js/handsfree.js"></script>
  <script src="js/voice.js"></script>
  <script src="js/settings.js"></script>
  <script src="js/migrate.js"></script>
  <script src="js/main.js"></script>
  <!-- Pager controls -->
  <div id="pager" class="pager" aria-label="Pagination controls" hidden>
    <button id="btn-prev-page" class="pager-btn" aria-label="Previous page" title="Previous page">âŸ¨</button>
    <button id="btn-next-page" class="pager-btn" aria-label="Next page" title="Next page">âŸ©</button>
  </div>
</body>
</html>
